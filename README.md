# trinalysis
Tools for working with transactional data in R

Installation
------

```r
install.packages("devtools")

library(devtools)
install_github("ben519/trinalysis")
```

---

## Demo

### Simulate Random Transactions (with a realistic pattern of customer churn)
```r
library(trinalysis)

set.seed(2357)
transactions <- sample_transactions(
  nCusts=100, sdTransactions=10, sdAmount=10, minDate=as.Date("2010-1-1"), maxDate=as.Date("2015-12-31"), 
  products=c("baseball", "basketball", "football", "soccerball")
)

transactions
|  TransactionID  |  TransactionDate  |  CustomerID  |  Amount  |  Product   |
|:---------------:|:-----------------:|:------------:|:--------:|:----------:|
|        1        |    2011-11-23     |      1       |   6.88   |  football  |
|        2        |    2013-11-28     |      2       |   1.58   |  football  |
|        3        |    2010-12-09     |      3       |  16.07   | basketball |
|       ...       |        ...        |     ...      |   ...    |    ...     |
|       399       |    2015-03-15     |      99      |   4.25   | basketball |
|       400       |    2011-01-31     |      99      |  12.85   |  football  |
|       401       |    2015-01-02     |     100      |  16.52   |  baseball  |

```

### Extract customers from transactions
```r
customers <- get_customers(transactions, colsCategory=c("Product"))

customers
|  CustomerID  |  Transactions  |  TransactionDate.First  |  TransactionDate.Last  |  Product.First  |
|:------------:|:--------------:|:-----------------------:|:----------------------:|:---------------:|
|      1       |       1        |       2011-11-23        |       2011-11-23       |    football     |
|      2       |       1        |       2013-11-28        |       2013-11-28       |    football     |
|      3       |       3        |       2010-12-09        |       2013-07-21       |   basketball    |
|     ...      |      ...       |           ...           |          ...           |       ...       |
|      98      |       9        |       2014-04-14        |       2015-11-23       |   basketball    |
|      99      |       7        |       2010-02-12        |       2015-08-26       |   soccerball    |
|     100      |       1        |       2015-01-02        |       2015-01-02       |    baseball     |

```

### Cumulative Transactions by Month
```r
transactions.cmltv <- cumulate_transactions(transactions=transactions, colsFinancial="Amount")

transactions
|  CustomerID  |  FirstValuationDate  |  ValuationDate  |  Transactions.cmltv  |  Amount.cmltv  |
|:------------:|:--------------------:|:---------------:|:--------------------:|:--------------:|
|      1       |      2011-11-30      |   2011-11-30    |          1           |      6.88      |
|      2       |      2013-11-30      |   2013-11-30    |          1           |      1.58      |
|      3       |      2010-12-31      |   2010-12-31    |          1           |     16.07      |
|     ...      |         ...          |       ...       |         ...          |      ...       |
|      99      |      2010-02-28      |   2015-03-31    |          6           |     49.71      |
|      99      |      2010-02-28      |   2015-08-31    |          7           |     60.17      |
|     100      |      2015-01-31      |   2015-01-31    |          1           |     16.52      |

```

### Basic Cohort Analyses
```r
triangles <- make_triangles(transactions.cmltv, format="triangular")  # many params not shown

triangles
|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: ActiveCustomers



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: NewCustomers



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: NewCustomers.cmltv



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Amount



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Amount.cmltv



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Transactions



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Transactions.cmltv

```

### Transaction Cohort Analyses
```r
transCohorts <- transaction_cohorts(transactions, colCohort="Product")

transCohorts[["baseball"]]
|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: ActiveCustomers



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: NewCustomers



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: NewCustomers.cmltv



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Transactions



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Transactions.cmltv

```

### Customer Cohort Analyses
```r
custCohorts <- customer_cohorts(transactions.cmltv, customers, colCohort="Product.First")

custCohorts[["football"]]

|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: ActiveCustomers



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: NewCustomers



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: NewCustomers.cmltv



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Amount



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Amount.cmltv



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Transactions



|            &nbsp;             |  12  |  24  |  36  |  48  |  60  |  72  |
|:-----------------------------:|:----:|:----:|:----:|:----:|:----:|:----:|
|  **2010-01-01 - 2010-12-31**  |  30  |  48  |  69  |  86  |  97  | 113  |
|  **2011-01-01 - 2011-12-31**  |  33  |  55  |  75  |  92  | 110  |  NA  |
|  **2012-01-01 - 2012-12-31**  |  17  |  34  |  42  |  50  |  NA  |  NA  |
|  **2013-01-01 - 2013-12-31**  |  29  |  50  |  70  |  NA  |  NA  |  NA  |
|  **2014-01-01 - 2014-12-31**  |  22  |  38  |  NA  |  NA  |  NA  |  NA  |
|  **2015-01-01 - 2015-12-31**  |  20  |  NA  |  NA  |  NA  |  NA  |  NA  |

Table: Transactions.cmltv

```


## Contact
If you'd like to contact me regarding bugs, questions, or general consulting, feel free to drop me a line - bgorman519@gmail.com
